<!DOCTYPE html>
<html lang="es" dir="ltr">

<head>
  <meta name="generator" content="Hugo 0.82.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Puertos de entrada/salida de propósito general. #  Cando pensamos en programar microcontroladores, lo que queremos es hacer que el mundo se mueva, controlar un motor, un relevador, una lampara, altavoz, etc. Para ello los microcontroladores cuentan con una serie de periféricos. A grandes rasgos un periférico puede definirse como: una interfaz que permite al microcontrolador comunicarse con el exterior, en esta entrada describiremos los puertos de entrada/salida de propósito general; GPIOx.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Periféricos atmega328p.- Puertos de entrada/salida de propósito general (GPIO)" />
<meta property="og:description" content="Puertos de entrada/salida de propósito general. #  Cando pensamos en programar microcontroladores, lo que queremos es hacer que el mundo se mueva, controlar un motor, un relevador, una lampara, altavoz, etc. Para ello los microcontroladores cuentan con una serie de periféricos. A grandes rasgos un periférico puede definirse como: una interfaz que permite al microcontrolador comunicarse con el exterior, en esta entrada describiremos los puertos de entrada/salida de propósito general; GPIOx." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.eleckia.xyz/docs/perifericos/gpio/perifericos-atmega328p-puertos-de-entrada-salida-de-proposito-general-gpio/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2019-06-13T19:18:09&#43;00:00" />
<meta property="article:modified_time" content="2019-06-13T19:18:09&#43;00:00" />

<title>Periféricos atmega328p.- Puertos de entrada/salida de propósito general (GPIO) | Blog sobre sistemas embebidos</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.2bc2364a4a4b31f0ec1debecf0a8f90a840821f143dfe1ac6a0f7cbcbdcf64ac.css" integrity="sha256-K8I2SkpLMfDsHevs8Kj5CoQIIfFD3&#43;Gsag98vL3PZKw=">
<script defer src="/es.search.min.90eea19857646012662363043ecd38aac5dcb6a2a87d1116eb0523848b03016e.js" integrity="sha256-kO6hmFdkYBJmI2MEPs04qsXctqKofREW6wUjhIsDAW4="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/"><span>Blog sobre sistemas embebidos</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Buscar" aria-label="Buscar" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6f6f484549ce2d8602f7989616e2f29f" class="toggle"  />
    <label for="section-6f6f484549ce2d8602f7989616e2f29f" class="flex justify-between">
      <a href="https://www.eleckia.xyz/docs/workstation/" class="">Estación de trabajo.</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/workstation/arduino-basico-iii/" class="">Arduino Básico III</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/workstation/arduino-basico-ii-hola-mundo/" class="">Arduino Básico II.- Hola Mundo</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/workstation/arduino-basico-i/" class="">Arduino Básico I.</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/workstation/estacion-de-trabajo-iv/" class="">Estación de trabajo IV</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/workstation/estacion-de-trabajo-iii/" class="">Estación de trabajo III</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/workstation/estacion-de-trabajo-ii/" class="">Estación de trabajo II</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/workstation/estacion-de-trabajo-i/" class="">Estación de trabajo I</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c5a8f28f5516b1587793df786fc2352d" class="toggle"  />
    <label for="section-c5a8f28f5516b1587793df786fc2352d" class="flex justify-between">
      <a href="https://www.eleckia.xyz/docs/avr/" class="">Programación Avr en C.</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-arreglos/" class="">Programando Avr en C. Arreglos.</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-apuntadores-punteros-pointers-ii-apuntadores-dobles/" class="">Programando Avr en C.- Apuntadores, punteros, pointers III. Apuntadores Dobles.</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-apuntadores-punteros-pointers-ii-apuntadores-a-funciones/" class="">Programando Avr en C.- Apuntadores, punteros, pointers II. Apuntadores a funciones.</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-apuntadores-punteros-pointers/" class="">Programando Avr en C.- Apuntadores, punteros, pointers I.</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-el-flujo-del-programa-if-else-if-else/" class="">Programando Avr en C.- El flujo del programa, if, else, if else.</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-constantes/" class="">Programando Avr en C.- Constantes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-tipo-de-dato-booleano-operadores-booleanos-y-de-comparacion/" class="">Programando Avr en C.- Tipo de dato Booleano, operadores booleanos y de comparación.</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-funciones/" class="">Programando Avr en C.- Funciones</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-variables-y-tipos-caracteres/" class="">Programando Avr en C.- Variables y tipos, caracteres.</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-variables-y-tipos-enteros/" class="">Programando Avr en C.- Variables y tipos.- Enteros.</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/avr/programando-avr-en-c-hola-mundo/" class="">Programando Avr en C.- Hola mundo</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Perifericos</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-32e0e2a16668b9d33b9df31ea5765d8c" class="toggle" checked />
    <label for="section-32e0e2a16668b9d33b9df31ea5765d8c" class="flex justify-between">
      <a  class="">GPIO</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/perifericos/gpio/biblioteca7/" class="">Api Display Siete Segmentos</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://www.eleckia.xyz/docs/perifericos/gpio/perifericos-atmega328p-puertos-de-entrada-salida-de-proposito-general-gpio/" class=" active">Periféricos atmega328p.- Puertos de entrada/salida de propósito general (GPIO)</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Periféricos atmega328p.- Puertos de entrada/salida de propósito general (GPIO)</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#puertos-de-entradasalida-de-propósito-general">Puertos de entrada/salida de propósito general.</a></li>
    <li><a href="#configurar-un-pin-como-salida">Configurar un Pin como Salida.</a></li>
    <li><a href="#configurar-un-pin-como-entrada">Configurar un Pin como Entrada.</a></li>
    <li><a href="#establecer-el-estado-cuando-el-pin-es-una-salida">Establecer el estado cuando el pin es una salida.</a></li>
    <li><a href="#resistencia-de-pull-up">Resistencia de Pull up.</a></li>
    <li><a href="#leer-el-estado-de-un-pin">Leer el estado de un pin.</a></li>
    <li><a href="#operadores-de-asignación">Operadores de asignación.</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h2 id="puertos-de-entradasalida-de-propósito-general">
  Puertos de entrada/salida de propósito general.
  <a class="anchor" href="#puertos-de-entradasalida-de-prop%c3%b3sito-general">#</a>
</h2>
<p>Cando pensamos en programar microcontroladores, lo que queremos es hacer que el
mundo se mueva, controlar un motor, un relevador, una lampara, altavoz, etc.
Para ello los microcontroladores cuentan con una serie de periféricos.
A grandes rasgos un periférico puede definirse como: una interfaz que permite
al microcontrolador comunicarse con el exterior, en esta entrada describiremos
los puertos de entrada/salida de propósito general; GPIOx.</p>
<p>Según la hoja de datos el atmega328p tiene hasta 23 pines programables, cada
uno con la posibilidad de ser programado individualmente, Arduino Uno tiene 20
pines disponibles, pues 2 están destinados al reloj y el otro está destinado al
pin de reset.</p>
<p>Los pines están agrupados en puertos, en el atmega328 contamos con tres puertos
disponibles, PORTB, PORTC, PORTD, de manera genérica los llamamos PORTx,  cada
uno de estos puertos cuentan con tres registros asociados, DDRx, PORTx, PINx,
donde &ldquo;x&rdquo; es el puerto(B, C, D), estos nueve registros nos permiten configurar
y acceder a los valores de cada uno de los pines pertenecientes al
microcontrolador.</p>
<p>Los pines en el microcontrolador tienen un nombre del tipo Pxn, donde x es el
puerto y n es él número de pin, el pin PB0 y el pin PD7, son el pin 0 y el pin 7
del puerto B y del puerto D respectivamente.</p>
<h2 id="configurar-un-pin-como-salida">
  Configurar un Pin como Salida.
  <a class="anchor" href="#configurar-un-pin-como-salida">#</a>
</h2>
<p>El acceso a los pines individuales no es posible, estamos limitados a
a operaciones que involucran 8 bits como mínimo, pues este es el
tamaño del bus de datos y de los registros. Por lo tanto si requerimos escribir
el estado del pin PB3, necesariamente debemos escribir todo el puerto B,
desde PB0 hasta PB7 (el atmega328p no tiene disponibles todos lo pines PBn).</p>
<p>Suponiendo que requerimos encender un led que esta conectado al pin PB4,
podemos hacer una asignación al registro <strong>DDRB</strong> (Direction Data Register)
como la siguiente</p>
<pre><code>DDRB = (1&lt;&lt;PB4);
//En binario es igual a
DDRB = 0b00010000;
</code></pre><p>Esto efectivamente coloca al pin 4 como salida, sin embargo coloca al resto de
los pines como entrada, para resolver este problema haremos uso del operador
binario <strong>or</strong>. El operador or compara <strong>bit a bit</strong> y <strong>posición por posición</strong>
con la regla,</p>
<pre><code>0 or 0 = 0
1 or 0 = 1
0 or 1 = 1
1 or 1 = 1
</code></pre><p>Por ejemplo, para los números binarios, 100 y 010, el resultado de hacer un or
bit a bit es</p>
<pre><code>bit2 bit1 bit0
   1    0    0
   or   or   or
   0    1    0
--------------
   1    1    0  Resultado
</code></pre><p>Asumiendo que el registro DDRB contiene el valor 0000 0111, es decir los 3
primeros bits están configurados como salidas, requerimos hacer que el bit
correspondiente a PB4 sea 1, sin modificar el resto, para ello usamos la
sintaxis,</p>
<pre><code>DDRB = DDRB | (1&lt;&lt;PB4);
</code></pre><p>El símbolo <strong>|</strong>, es el operador binario or, significa: or binario entre DDRB y
el resultado de la operación <code>(1&lt;&lt;PB4)</code>,</p>
<pre><code>DDRB = DDRB | (1&lt;&lt;PB4);
//Es igual a 
DDRB = 0b00000111 | 0b00010000;
//Ahora se hacer or, resulta
DDRB = 0b00010111;
//DDRB queda con el bit 5 en 1 y el resto sin modificar
</code></pre><h2 id="configurar-un-pin-como-entrada">
  Configurar un Pin como Entrada.
  <a class="anchor" href="#configurar-un-pin-como-entrada">#</a>
</h2>
<p>Para poder hacer acciones más complejas requerimos que nuestro microcontrolador
pueda &ldquo;sentir&rdquo; el mundo, los pines de nuestro microcontrolador pueden
configurarse para que se pueda interpretar el estado de un pin, establecido por
un elemento externo (como un botón pulsador). Para ello también se utiliza el
registro DDRx, pero en esta ocasión el pin a ser configurado se establece como
un cero.</p>
<p>El operador binario and <strong>&amp;</strong>, similar al operador or realiza la operación and bit a bit, con la siguiente regla,</p>
<pre><code>0 and 0 = 0
0 and 1 = 0
1 and 0 = 0
1 and 1 = 1
</code></pre><p>Por ejemplo en los siguientes números binarios el resultado es,</p>
<pre><code>bit2 bit1 bit0
   1    0    0
       and
   0    1    0
-------------- 
   0    0    0
</code></pre><p>Otro operador (en este caso unario) importante es el complemento a uno <strong>~</strong>,
cambia el valor de 1 a 0 y de 0 a 1, por ejemplo:</p>
<pre><code>1010
  ~
-----
0101
</code></pre><p>Asumiendo que el registro DDRC contiene el número 010 0011, requerimos
configurar el pin PC0 como entrada, asignar DDRC = 0 no es aceptable (colocaría
todos los pines como entrada), en su lugar usaremos el siguiente código</p>
<pre><code>DDRC = DDRC &amp; ~(1&lt;&lt;PC0);
//Primero se realiza (1&lt;&lt;PC0), resulta
DDRC = DDRC &amp; ~0b00000001;
//Ahora se aplica el operador complemento, resulta
DDRC = DDRC &amp; 0b11111110;
//Operador And bit a bit,
DDRC = 0b00100011 &amp; 0b11111110;
//Resulta
DDRC = 0b00100010;
</code></pre><p>De esta forma logramos establecer el pin requerido sin afectar el resto.</p>
<h2 id="establecer-el-estado-cuando-el-pin-es-una-salida">
  Establecer el estado cuando el pin es una salida.
  <a class="anchor" href="#establecer-el-estado-cuando-el-pin-es-una-salida">#</a>
</h2>
<p>Cuando un pin es configurado como salida, puede entregar/recibir potencia,
poquita, pero suficiente para mover al mundo, para ello se requiere establecer
el estado del pin, asumiendo que tenemos conectado un led al pin PB4 y que dicho
pin esta configurado como salida en el registro DDRB, entonces podemos
establecer el estado del pin en el registro <strong>PORTB</strong>, donde un cero es nivel
bajo(0 V) y un uno es nivel alto (5 V).</p>
<pre><code>//Led encendido
PORTB = PORTB | (1&lt;&lt;PB4);
//Led apagado 
PORTB = PORTB &amp; ~(1&lt;&lt;PB4);
</code></pre><p>Por supuesto lo mismo aplica para los otros puertos.</p>
<h2 id="resistencia-de-pull-up">
  Resistencia de Pull up.
  <a class="anchor" href="#resistencia-de-pull-up">#</a>
</h2>
<p>¿Qué pasa cuando
escribimos los registros PORTx cuando DDRx es configurado como entrada?, la
respuesta es que con un uno se conecta una resistencia interna llamada de
Pull Up, mientras que con un cero se desconecta, la resistencia de pull up es
de gran utilidad cuando se censan entradas, un pin configurado como entra,
tiene la característica de ser sensible al ruido electromagnético  del
ambiente, cuando se activa la resistencia de pull up se produce una corriente
que pasa por el pin, disminuyendo la sensibilidad al ruido y obligando una
tensión en el pin en nivel alto (5 Volts).</p>
<h2 id="leer-el-estado-de-un-pin">
  Leer el estado de un pin.
  <a class="anchor" href="#leer-el-estado-de-un-pin">#</a>
</h2>
<p>Cuando requerimos leer el estado del pin, utilizamos el registro <strong>PINx</strong>, es un
registro de 8 bits, contiene el estado de cada unos de los pines del puerto,
Para censar al pin, debemos configurarlo como entrada en el registro DDRx.</p>
<p>Para
leer el estado del pin PC0, asumiendo que PC0 esta conectado a 5V y que PC0
esta configurado como entrada en DDRC (con un cero),</p>
<pre><code>//suponiendo que declaramos una variable adecuada llamada
//entrada
entrada = PINC &amp; (1&lt;&lt;PC0);
//Es igual a
entrada = 0bxxxxxxx1 &amp; 0b00000001;
//donde las x pueden ser 0 o 1
//aplicando and bit a bit resulta en
entrada = 0b00000001;
//entrada es exactamente igual a
entrada = 1;
//si PC0 estuvera conectado a tierra, 
//entrada resultaría en
entrada = 0bxxxxxxx0 &amp; 0b00000001;
//aplicando and bit a bit resulta en
entrada =0b00000000;
//o
entrada = 0;
</code></pre><h2 id="operadores-de-asignación">
  Operadores de asignación.
  <a class="anchor" href="#operadores-de-asignaci%c3%b3n">#</a>
</h2>
<p>Para evitar verbosidad podemos usar operadores de asignación más complejos,
por ahora presento dos adicionales, |= y &amp;=, su utilidad es obvia</p>
<pre><code>//en lugar de 
PORTx = PORTx | (1&lt;&lt;Pxn);
DDRx = DDRx &amp; ~(1&lt;&lt;Pxn);
//podemos usar
PORTx |= 1&lt;&lt;Pxn;
DDRx &amp;= ~(1&lt;&lt;Pxn);
//ambas expresiones producen resultados
//identicos
</code></pre></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#puertos-de-entradasalida-de-propósito-general">Puertos de entrada/salida de propósito general.</a></li>
    <li><a href="#configurar-un-pin-como-salida">Configurar un Pin como Salida.</a></li>
    <li><a href="#configurar-un-pin-como-entrada">Configurar un Pin como Entrada.</a></li>
    <li><a href="#establecer-el-estado-cuando-el-pin-es-una-salida">Establecer el estado cuando el pin es una salida.</a></li>
    <li><a href="#resistencia-de-pull-up">Resistencia de Pull up.</a></li>
    <li><a href="#leer-el-estado-de-un-pin">Leer el estado de un pin.</a></li>
    <li><a href="#operadores-de-asignación">Operadores de asignación.</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>

</html>












